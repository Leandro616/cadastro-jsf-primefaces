<!DOCTYPE html>
<ui:composition
  lang="pt-br"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:p="http://primefaces.org/ui"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  template="WEB-INF/template/Layout.xhtml"
>
  <ui:define name="titulo"> Cadastro de Empresas </ui:define>

  <ui:define name="conteudo">
    <h:form>
      <p:panelGrid columns="2" layout="tabular" styleClass="ui-noborder style">
        <p:outputLabel for="razaoSocial" value="Razão Social" />
        <h:panelGroup>
          <p:inputText
            id="razaoSocial"
            value="#{gestaoEmpresasBean.empresa.razaoSocial}"
            required="true"
            label="Razão Social"
          />
          <p:message for="razaoSocial" />
        </h:panelGroup>

        <p:outputLabel for="nomeFantasia" value="Nome Fantasia" />
        <p:inputText
          id="nomeFantasia"
          value="#{gestaoEmpresasBean.empresa.nomeFantasia}"
        />

        <p:outputLabel for="tipo" value="Tipo Empresa" />
        <p:selectOneMenu
          id="tipo"
          value="#{gestaoEmpresasBean.empresa.tipo}"
          required="true"
        >
          <f:selectItem itemLabel="Selecione..." />
          <f:selectItems
            value="#{gestaoEmpresasBean.tiposEmpresa}"
            var="tipoEmpresa"
            itemLabel="#{tipoEmpresa.descricao}"
            itemValue="#{tipoEmpresa}"
          />
        </p:selectOneMenu>

        <p:outputLabel for="dataFundacao" value="Data Fundação" />
        <h:panelGroup>
          <p:inputText
            id="dataFundacao"
            value="#{gestaoEmpresasBean.empresa.dataFundacao}"
            label="Data Fundação"
          >
            <f:converter converterId="localDateConverter" />
          </p:inputText>
          <!-- exibe mensagens de erro do id definido -->
          <p:message for="dataFundacao" />
        </h:panelGroup>

        <p:outputLabel for="cnpj" value="CNPJ" />
        <h:panelGroup>
          <p:inputText
            id="cnpj"
            value="#{gestaoEmpresasBean.empresa.cnpj}"
            label="CNPJ"
          >
            <f:validateLength maximum="18" minimum="18" />
          </p:inputText>
          <p:message for="cnpj" />
        </h:panelGroup>

        <p:outputLabel for="faturamento" value="Faturamento" />
        <h:panelGroup>
          <p:inputText
            id="faturamento"
            value="#{gestaoEmpresasBean.empresa.faturamento}"
            label="Faturamento"
          >
            <f:convertNumber minFractionDigits="2" maxFractionDigits="2" />
            <f:validateDoubleRange minimum="0" />
          </p:inputText>
          <p:message for="faturamento" />
        </h:panelGroup>

        <!-- como o primefaces usa ajax ele não atualiza todos os componentes em uma requisisão -->
        <!-- por isso usamos aqui o update passando o id do componente ou um alias nesse caso -->
        <p:commandButton
          value="Salvar"
          actionListener="#{gestaoEmpresasBean.salvar}"
          update="@form"
        />
      </p:panelGrid>
    </h:form>

    <h:form>
      <p:dataTable
        var="empresa"
        value="#{gestaoEmpresasBean.empresas}"
        paginator="true"
        rows="5"
        paginatorPosition="bottom"
        allowUnsorting="true"
      >
        <p:column headerText="Nome" sortBy="#{empresa.nomeFantasia}">
          <h:outputText value="#{empresa.nomeFantasia}" />
        </p:column>
        <p:column headerText="Razão Social">
          <h:outputText value="#{empresa.razaoSocial}" />
        </p:column>
        <p:column headerText="CNPJ">
          <h:outputText value="#{empresa.cnpj}" />
        </p:column>
        <p:column headerText="Data Fundação">
          <h:outputText value="#{empresa.dataFundacao}" />
        </p:column>
        <p:column headerText="Ramo">
          <h:outputText value="#{empresa.ramoAtividade.descricao}" />
        </p:column>
        <p:column headerText="Tipo">
          <h:outputText value="#{empresa.tipo.descricao}" />
        </p:column>
        <p:column headerText="Faturamento">
          <h:outputText value="#{empresa.faturamento}" />
        </p:column>
      </p:dataTable>
    </h:form>
  </ui:define>
</ui:composition>
