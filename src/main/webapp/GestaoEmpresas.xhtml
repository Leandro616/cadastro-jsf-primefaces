<!DOCTYPE html>
<ui:composition
  lang="pt-br"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:p="http://primefaces.org/ui"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  template="WEB-INF/template/Layout.xhtml"
>
  <ui:define name="titulo"> Empresas </ui:define>

  <ui:define name="conteudo">
   
    <h:form>
      <p:toolbar>
        <p:toolbarGroup>
          <p:commandButton
            type="button"
            value="Nova Empresa"
            icon="pi pi-plus-circle"
            onclick="PF('DialogFormEmpresaVar').show()"
          />
          <p:commandButton
            type="button"
            value="Exportar Excel"
            icon="pi pi-file-excel"
            styleClass="ui-button-success ml-2"
          />

          <i class="pi pi-pause mx-3"></i>
          <p:commandButton
            type="button"
            title="Editar"
            icon="pi pi-pencil"
            styleClass="ui-button-warning mr-2"
          />
          <p:commandButton
            type="button"
            title="Excluir"
            icon="pi pi-trash"
            styleClass="ui-button-danger"
          />
        </p:toolbarGroup>
        <p:toolbarGroup align="right">
          <p:inputText
            placeholder="Digite um termo para pesquisa..."
            styleClass="mr-2"
          />

          <p:commandButton
            type="button"
            value="Pesquisar"
            icon="pi pi-search"
          />
        </p:toolbarGroup>
      </p:toolbar>

      <p:dataTable
        var="empresa"
        value="#{gestaoEmpresasBean.empresas}"
        paginator="true"
        rows="5"
        paginatorPosition="bottom"
        allowUnsorting="true"
      >
        <p:column headerText="Nome" sortBy="#{empresa.nomeFantasia}">
          <h:outputText value="#{empresa.nomeFantasia}" />
        </p:column>
        <p:column headerText="Razão Social">
          <h:outputText value="#{empresa.razaoSocial}" />
        </p:column>
        <p:column headerText="CNPJ">
          <h:outputText value="#{empresa.cnpj}" />
        </p:column>
        <p:column headerText="Data Fundação">
          <h:outputText value="#{empresa.dataFundacao}" />
        </p:column>
        <p:column headerText="Ramo">
          <h:outputText value="#{empresa.ramoAtividade.descricao}" />
        </p:column>
        <p:column headerText="Tipo">
          <h:outputText value="#{empresa.tipo.descricao}" />
        </p:column>
        <p:column headerText="Faturamento">
          <h:outputText value="#{empresa.faturamento}" />
        </p:column>
      </p:dataTable>

      <p:dialog 
        header="Nova empresa"
        widgetVar="DialogFormEmpresaVar"
        modal="true"
        resizable="false"
        closeOnEscape="true"
        width="720"
      >

        <div class="formgrid grid ui-fluid">
          <div class="field col-12 md:col-6">
            <p:outputLabel for="razaoSocial" value="Razão Social" />
            <p:inputText
              id="razaoSocial"
              value="#{gestaoEmpresasBean.empresa.razaoSocial}"
              required="true"
              label="Razão Social"
            />
          </div>

          <div class="field col-12 md:col-6">
            <p:outputLabel for="nomeFantasia" value="Nome Fantasia" />
            <p:inputText
              id="nomeFantasia"
              value="#{gestaoEmpresasBean.empresa.nomeFantasia}"
            />
          </div>
          <div class="field col-12 md:col-6">
            <p:outputLabel for="tipo" value="Tipo Empresa" />
            <p:selectOneMenu
              id="tipo"
              value="#{gestaoEmpresasBean.empresa.tipo}"
              required="true"
            >
              <f:selectItem itemLabel="Selecione..." />
              <f:selectItems
                value="#{gestaoEmpresasBean.tiposEmpresa}"
                var="tipoEmpresa"
                itemLabel="#{tipoEmpresa.descricao}"
                itemValue="#{tipoEmpresa}"
              />
            </p:selectOneMenu>
          </div>
          <div class="field col-12 md:col-6">
            <p:outputLabel for="dataFundacao" value="Data Fundação" />
            <p:inputText
              id="dataFundacao"
              value="#{gestaoEmpresasBean.empresa.dataFundacao}"
              label="Data Fundação"
            >
              <f:converter converterId="localDateConverter" />
            </p:inputText>
          </div>
          <div class="field col-12 md:col-6">
            <p:outputLabel for="cnpj" value="CNPJ" />
            <p:inputText
              id="cnpj"
              value="#{gestaoEmpresasBean.empresa.cnpj}"
              label="CNPJ"
            >
              <f:validateLength maximum="18" minimum="18" />
            </p:inputText>
          </div>
          <div class="field col-12 md:col-6">
            <p:outputLabel for="faturamento" value="Faturamento" />
            <p:inputText
              id="faturamento"
              value="#{gestaoEmpresasBean.empresa.faturamento}"
              label="Faturamento"
            >
              <f:convertNumber minFractionDigits="2" maxFractionDigits="2" />
              <f:validateDoubleRange minimum="0" />
            </p:inputText>
          </div>
          <div class="col-12 text-center">
            <!-- como o primefaces usa ajax ele não atualiza todos os componentes em uma requisisão -->
            <!-- por isso usamos aqui o update passando o id do componente ou um alias nesse caso -->
            <p:commandButton
              value="Salvar"
              actionListener="#{gestaoEmpresasBean.salvar}"
              update="@form" 
              styleClass="w-auto"
            />
          </div>
        </div>
       
      </p:dialog>
    </h:form>
  </ui:define>
</ui:composition>
